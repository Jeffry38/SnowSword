(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21dbc6"],{d323:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-main",[n("el-tabs",{attrs:{type:"card",editable:""},on:{edit:e.handleTabsEdit},model:{value:e.content.currentTabName,callback:function(t){e.$set(e.content,"currentTabName",t)},expression:"content.currentTabName"}},e._l(e.content.tabs,(function(e){return n("el-tab-pane",{key:e.name,ref:"xterm"+e.name,refInFor:!0,attrs:{label:e.title,name:e.name}})})),1),0==e.content.tabs.length?n("el-empty",{attrs:{description:"Êú™ÈÄâÊã©Webshell"}}):e._e()],1),n("el-dialog",{attrs:{title:"ÈÄâÊã©Êï∞ÊçÆ",visible:e.selectWebshellForm.visible,width:"40%"},on:{"update:visible":function(t){return e.$set(e.selectWebshellForm,"visible",t)}}},[n("el-form",{attrs:{model:e.selectWebshellForm}},[n("el-form-item",{attrs:{label:"URL",required:""}},[n("el-select",{staticStyle:{width:"85%"},attrs:{placeholder:"ËØ∑ÈÄâÊã©"},model:{value:e.selectWebshellForm.webshellId,callback:function(t){e.$set(e.selectWebshellForm,"webshellId",t)},expression:"selectWebshellForm.webshellId"}},e._l(e.webshells,(function(e){return n("el-option",{key:e.id,attrs:{label:e.url,value:e.id}})})),1)],1)],1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.selectWebshellForm.visible=!1}}},[e._v("Âèñ Ê∂à")]),n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.selectWebshell(!0)}}},[e._v("Á°Æ ÂÆö")])],1)],1)],1)},l=[],s=(n("d3b7"),n("159b"),n("b0c0"),n("4de4"),n("ac1f"),n("466d"),n("f6d6"),n("498a"),n("b775")),r=(n("abb2"),n("fcf3")),o=n("47d0"),i={data:function(){return{webshells:[],content:{currentTabName:null,tabIndex:0,tabs:[]},selectWebshellForm:{visible:!1,webshellId:null}}},methods:{handleTabsEdit:function(e,t){if("add"===t&&this.selectWebshell(!1),"remove"===t){var n=this.content.tabs,a=this.content.currentTabName;a===e&&n.forEach((function(t,l){if(t.name===e){var s=n[l+1]||n[l-1];s&&(a=s.name)}})),this.content.currentTabName=a,this.content.tabs=n.filter((function(t){return t.name!==e}))}},fetchWebshellData:function(){var e=this;Object(s["a"])({url:"/webshell/findAll",method:"get"}).then((function(t){e.webshells=t.data})).catch((function(e){console.log(e)}))},selectWebshell:function(e){var t=this;if(e){this.selectWebshellForm.visible=!1;var n=++this.content.tabIndex+"",a=this.selectWebshellForm.webshellId,l=this.content.tabs.push({title:"Âä†ËΩΩ‰∏≠...",name:n,id:a})-1;this.content.currentTabName=n,Object(s["a"])({url:"/webshell/getTerminalInfoById",method:"get",params:{id:a}}).then((function(e){var a=e.data.url,s=a.match(/https?:\/\/(.*)?\//);t.content.tabs[l].title=s?s[1]:a;var i=new r["Terminal"]({rendererType:"canvas",rows:50,convertEol:!0,disableStdin:!1,cursorStyle:"underline",cursorBlink:!0,theme:{foreground:"#BFCBD9",background:"#304156",cursor:"help"}}),c=new o["FitAddon"];i.loadAddon(c),t.content.tabs[l].term=i,t.content.tabs[l].fitAddon=c,t.content.tabs[l].path=e.data.path,t.content.tabs[l].hostname=e.data.hostname,t.content.tabs[l].user=e.data.user,t.$forceUpdate(),t.openTerm(t.$refs["xterm"+n][0].$el,t.content.tabs[l])})).catch((function(e){t.content.tabs[l].title="Âä†ËΩΩÂ§±Ë¥•",console.log(e)}))}else this.selectWebshellForm.visible=!0},openTerm:function(e,t){t.term.open(e),t.fitAddon.fit(),t.term.focus();var n=t.user+"@"+t.hostname+": "+t.path;t.term.writeln(n),t.term.write("$ "),t.command="",t.termOnData=function(e){switch(e){case String.fromCodePoint(13):t.term.write(e+"\n"),"clear"!=t.command.trim()&&"cls"!=t.command.trim()||(console.log(1),t.term.clear(),t.term.write("[H[2J")),Object(s["a"])({url:"/webshell/executeCommandById",method:"post",data:{id:t.id,path:t.path,command:t.command}}).then((function(e){t.term.writeln(e.data.result),t.path=e.data.path;var n=t.user+"@"+t.hostname+": "+t.path;t.term.writeln(n),t.term.write("$ ")})).catch((function(e){console.log(e)})),t.command="";break;case String.fromCodePoint(127):if(t.command.length<=0)break;t.command.charCodeAt(t.command.length-1)>127?t.term.write("\b\b  \b\b"):t.term.write("\b \b"),t.command=t.command.substring(0,t.command.length-1);break;case String.fromCodePoint(27)+"[A":break;case String.fromCodePoint(27)+"[B":break;case String.fromCodePoint(27)+"[D":break;case String.fromCodePoint(27)+"[C":break;case String.fromCodePoint(9):break;default:t.command=t.command+e,t.term.write(e)}},t.term.onData(t.termOnData)},resize:function(){for(var e in this.content.tabs)this.content.tabs[e].fitAddon&&this.content.tabs[e].fitAddon.fit()}},created:function(){this.fetchWebshellData(),this.name=this.$route.name,this.$route.params.id&&(this.selectWebshellForm.webshellId=this.$route.params.id,this.selectWebshell(!0)),window.addEventListener("resize",this.resize)},watch:{$route:function(e,t){e.name==this.name&&(this.fetchWebshellData(),this.$route.params.id&&(this.selectWebshellForm.webshellId=this.$route.params.id,this.selectWebshell(!0)))}},mounted:function(){window.vue=this}},c=i,m=n("2877"),d=Object(m["a"])(c,a,l,!1,null,null,null);t["default"]=d.exports}}]);